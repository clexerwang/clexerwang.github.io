<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><title>JavaScript的模块化</title><link rel="stylesheet" href="/css/layout.css">
<link rel="stylesheet" href="/css/main.css"><link rel="shortcut icon" href="/img/favicon.png"></head><body><header class="base-menu"><div class="menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a href="/" class="menu-link">Clexer</a></li><li class="menu-item"><a href="/blog/archives" class="menu-link">Archives</a></li><li class="menu-item"><a href="/about" class="menu-link">About</a></li></ul></nav></div></header><header class="base-mobile-menu"><div class="mobile-menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a href="/" class="menu-link">Clexer</a></li><li class="menu-item"><a href="/blog/archives" class="menu-link">Archives</a></li><li class="menu-item"><a href="/about" class="menu-link">About</a></li></ul></nav><div id="mobile-menu-toggle" class="toggle-menu"><span class="menu-bar"></span><span class="menu-bar"> </span><span class="menu-bar"></span></div></div></header><div class="base-content"><div class="base-content-main"><article class="article-main"><h1 class="article-title">JavaScript的模块化</h1><div class="article-meta"><p class="meta-item meta-time"><span class="meta-item-title">发表于: </span>2019-03-13</p><p class="meta-item meta-category"></p></div><div class="article-content"><p>目前流行的js模块化规范有CommonJS、AMD、CMD以及ES6的模块系统</p>
<p>##CommonJS—NodeJS<br>根据<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">```Node.js```是```CommonJS```规范的主要实践者，```CommonJS```用```同步```的方式加载模块。</span><br><span class="line">```Node.js```有四个重要的环境变量为模块化的实现提供支持：```module```、```exports```、```require```、```global```。</span><br><span class="line">```module.exports```是当前模块对外输出的接口（不推荐直接用exports），把需要对外输出的内容放在该对象中。</span><br><span class="line">```require```用来加载模块</span><br><span class="line"></span><br><span class="line">commonJS用同步的方式加载模块。在服务端，模块文件都存在本地磁盘，读取非常快，所以这样做不会有问题。但是在浏览器端，限于网络原因，更合理的方案是使用异步加载。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">####exports和module.exports的关系</span><br><span class="line">它们之间的关系其实类似于这样：</span><br><span class="line"></span><br><span class="line">	var exports = module.exports</span><br><span class="line">	//所以，exports的本质还是module.exports,但是不能把要输出的值赋值给exports；</span><br><span class="line">	</span><br><span class="line">	exports = &#123;&#125;；这样相当于修改了exports的指向。</span><br><span class="line"></span><br><span class="line">##AMD---RequireJS</span><br><span class="line"></span><br><span class="line">```RequireJS```在加载依赖模块时是异步加载，这样浏览器不会失去响应，同时它指定的回调函数，只有在前面的模块都加载成功后，才会运行，解决了依赖性的问题。</span><br><span class="line"></span><br><span class="line">```require.config()```用来指定引用路径，```define()```用来定义模块，```require()```用来加载模块。</span><br><span class="line">使用时要先在网页中引入```require.js```,设置```data-main```属性：</span><br><span class="line">```&lt;script src=&quot;js/require.js&quot; data-main=&quot;js/main&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<p>同时要设置一个入口文件<code>main.js</code>，<code>main.js</code>中配置<code>require.config()</code>并规定项目中用到的基础模块。</p>
<p>main.js:</p>
<pre><code>require.config(
    baseUrl: &quot;js/lib&quot;,
  paths: {
    &quot;jquery&quot;: &quot;jquery.min&quot;,  //实际路径为js/lib/jquery.min.js
    &quot;underscore&quot;: &quot;underscore.min&quot;,
  }
)
</code></pre><p>在引用模块时：<br>将模块名放在<code>[]</code>中作为<code>reqiure()</code>的第一参数；</p>
<pre><code>require([&apos;a&apos;],function(first_Module){

})
</code></pre><p>定义模块时：<br>如果我们定义的模块本身也依赖其他模块,那就需要将它们放在<code>[]</code>中作为<code>define()</code>的第一参数。</p>
<pre><code>define([&apos;a&apos;,&apos;b&apos;],function(module_a,module_b){

    return {}
})
</code></pre><p>##CMD—SeaJS<br><code>require.js</code>在申明依赖的模块时会在第一时间加载并执行模块内的代码。</p>
<p>CMD是另一种js模块化方案，它与AMD很类似，不同点在于：AMD 推崇<code>依赖前置、提前执行</code>，CMD推崇<code>依赖就近、延迟执行</code>。</p>
<p>定义模块：</p>
<pre><code>//require 是一个方法，接受模块标识作为唯一参数，用来获取其他模块提供的接口：require(id)；
//exports 是一个对象，用来向外提供模块接口；
//module 是一个对象，上面存储了与当前模块相关联的一些属性和方法；
define(function(require, exports, module) {
    var a = require(&apos;./a&apos;); //在需要时申明依赖模块
    a.doSomething();
    if (false) {
        var b = require(&apos;./b&apos;);
        b.doSomething();
    }
    exports.ab = function(){}; 
});
</code></pre><p>引用模块：</p>
<pre><code>seajs.use([&apos;a&apos;],function(module_a){

})
</code></pre><p>##AMD与CMD<br>AMD和CMD最大的区别是对依赖模块的执行时机处理不同：<br>AMD与CMD在加载模块时都是异步的，只不过AMD依赖前置，JS可以方便知道依赖模块是谁，立即加载，而CMD就近依赖，需要先把模块变为字符串解析一遍才知道依赖了那些模块，然后再加载模块。</p>
<p>AMD在加载模块完成后就会执行该模块，所有模块都加载执行完后会进入require的回调函数，执行主逻辑，这样的效果就是依赖模块的执行顺序和书写顺序不一定一致，看网络速度，哪个先下载下来，哪个先执行，但是主逻辑一定在所有依赖加载完成后才执行。<br>CMD加载完某个依赖模块后并不执行，只是下载而已，在所有依赖模块加载完成后进入主逻辑，遇到require语句的时候才执行对应的模块，这样模块的执行顺序和书写顺序是完全一致的。</p>
<p>##ES6模块机制：</p>
<p>##ES6与CommonJS区别</p>
<p> CommonJS 模块是运行时加载，ES6 模块是编译时加载：</p>
<p><code>运行时加载</code>: CommonJS 模块就是对象；即在输入时是先加载整个模块，生成一个对象，然后再从这个对象上面读取方法，这种加载称为“运行时加载”。</p>
<p><code>编译时加载</code>: ES6 模块不是对象，而是通过 export 命令显式指定输出的代码，import命令会被 JavaScript 引擎静态分析，在编译时就引入指定的模块代码，而不是加载整个模块，这种加载称为“编译时加载”。</p>
<p><a href="https://www.cnblogs.com/unclekeith/archive/2017/10/17/7679503.html" target="_blank" rel="noopener">https://www.cnblogs.com/unclekeith/archive/2017/10/17/7679503.html</a></p>
</div></article><div id="base-discus"></div></div></div><footer class="base-footer"><div class="footer-wrapper"><span>___ Using </span><a href="https://github.com/chuguixin/Simple"><span>Simple</span></a><span> Presents For You.</span></div></footer><div class="dom-ready"><script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script><script src="/js/base.js"></script></div></body></html>